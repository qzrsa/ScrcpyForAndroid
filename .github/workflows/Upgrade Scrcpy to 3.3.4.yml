name: Upgrade Scrcpy to Specific Version

on:
  workflow_dispatch:
    inputs:
      scrcpy_version:
        description: 'Scrcpy version to upgrade to (e.g., 3.3.4)'
        required: true
        default: '3.3.4'

jobs:
  upgrade:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Update Scrcpy to v${{ github.event.inputs.scrcpy_version }}
      run: |
        VERSION="${{ github.event.inputs.scrcpy_version }}"
        
        # 更新 build.gradle.kts 中的版本号
        sed -i "s/scrcpy:[0-9.]\+/scrcpy:${VERSION}/g" app/build.gradle.kts
        
        # 下载 scrcpy-server
        wget https://github.com/Genymobile/scrcpy/releases/download/v${VERSION}/scrcpy-server-v${VERSION}
        mkdir -p app/src/main/assets
        mv scrcpy-server-v${VERSION} app/src/main/assets/scrcpy-server
        
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v6
      with:
        commit-message: "chore: upgrade Scrcpy to v${{ github.event.inputs.scrcpy_version }}"
        title: "升级 Scrcpy 到 v${{ github.event.inputs.scrcpy_version }}"
        body: |
          手动升级 Scrcpy 到版本 ${{ github.event.inputs.scrcpy_version }}
        branch: upgrade-scrcpy-v${{ github.event.inputs.scrcpy_version }}
